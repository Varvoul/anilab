---
layout: layouts/base.njk
pagination:
  data: posts
  size: 1
  alias: post
permalink: "/watch/{{ post.id }}-{{ pagination.pageNumber }}/"
title: "Watch {{ post.title }} - Quravel"
---
<!DOCTYPE html>
<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>{{ title }}</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3B7A93", 
                        "primary-dark": "#2C5D70",
                        "background-light": "#f6f7f8",
                        "background-dark": "#0B0E14",
                        "surface-dark": "#151926",
                        "surface-light": "#1E2232",
                        "footer-dark": "#0C0E14",
                        "text-light": "#E5E7EB",
                        "text-muted": "#9CA3AF",
                        "border-dark": "#2A2E3B"
                    },
                    fontFamily: {
                        display: "Epilogue",
                        body: ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                        lg: "1rem",
                        xl: "1.5rem",
                        full: "9999px"
                    }
                }
            }
        };
    </script>
<link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #mobile-menu {
            transition: transform 0.3s ease-in-out;
        }
        .menu-open {
            transform: translateX(0) !important;
        }
        .video-overlay {
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.5) 20%, transparent 100%);
        }
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #3B7A93;
            cursor: pointer;
            margin-top: -4px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
        .sticky-vote {
             backdrop-filter: blur(12px);
             -webkit-backdrop-filter: blur(12px);
        }
        .dropdown-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .dropdown-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 100ms ease-out, transform 100ms ease-out;
        }
        .dropdown-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .dropdown-scroll::-webkit-scrollbar-track {
            background: #151926; 
        }
        .dropdown-scroll::-webkit-scrollbar-thumb {
            background: #3B7A93; 
            border-radius: 3px;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Search Dropdown Scrollbar */
        #nav-search-dropdown #nav-suggestions-list,
        #mobile-search-dropdown #mobile-suggestions-list {
            max-height: 400px;
            overflow-y: auto;
        }
        #nav-search-dropdown #nav-suggestions-list::-webkit-scrollbar,
        #mobile-search-dropdown #mobile-suggestions-list::-webkit-scrollbar {
            width: 6px;
        }
        #nav-search-dropdown #nav-suggestions-list::-webkit-scrollbar-track,
        #mobile-search-dropdown #mobile-suggestions-list::-webkit-scrollbar-track {
            background: #151926;
        }
        #nav-search-dropdown #nav-suggestions-list::-webkit-scrollbar-thumb,
        #mobile-search-dropdown #mobile-suggestions-list::-webkit-scrollbar-thumb {
            background: #3B7A93;
            border-radius: 3px;
        }
        /* Custom scrollbar for episode containers */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #0B0E14;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #3B7A93;
            border-radius: 2px;
        }
        /* Center player container */
        .player-container {
            margin-top: 1.5rem;
        }
        @media (min-width: 1024px) {
            .player-container {
                margin-top: 0;
            }
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-gray-900 dark:text-text-light transition-colors duration-300 min-h-screen flex flex-col relative">
<div class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden" id="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>
<div class="fixed top-0 left-0 h-full w-80 bg-white dark:bg-[#151926] z-50 transform -translate-x-full lg:hidden overflow-y-auto shadow-2xl transition-transform duration-300 ease-in-out" id="mobile-menu">
<div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center sticky top-0 bg-inherit z-10">
<img alt="Quravel Logo" class="h-8 object-contain" src="https://cdn.imgchest.com/files/449aa5626e23.png"/>
<button class="text-gray-500 hover:text-primary" onclick="toggleMobileMenu()">
<span class="material-symbols-outlined">close</span>
</button>
</div>
<div class="p-4 space-y-2">
<a class="block text-base font-medium hover:text-primary py-3 border-b border-gray-100 dark:border-gray-800" href="#">Home</a>
<div class="border-b border-gray-100 dark:border-gray-800">
<button class="flex items-center justify-between w-full text-base font-medium hover:text-primary focus:outline-none py-3" onclick="toggleMobileDropdown('genre-mobile')">
<span>Genre</span>
<span class="material-symbols-outlined text-sm transform transition-transform duration-200" id="genre-arrow">expand_more</span>
</button>
<div class="hidden mt-1 mb-3 ml-2 grid grid-cols-2 gap-2 text-sm text-gray-500 dark:text-gray-400" id="genre-mobile">
<a class="block hover:text-primary" href="#">Action</a>
<a class="block hover:text-primary" href="#">Adventure</a>
<a class="block hover:text-primary" href="#">Cars</a>
<a class="block hover:text-primary" href="#">Comedy</a>
<a class="block hover:text-primary" href="#">Dementia</a>
<a class="block hover:text-primary" href="#">Demons</a>
<a class="block hover:text-primary" href="#">Drama</a>
<a class="block hover:text-primary" href="#">Ecchi</a>
<a class="block hover:text-primary" href="#">Fantasy</a>
<a class="block hover:text-primary" href="#">Game</a>
<a class="block hover:text-primary" href="#">Harem</a>
<a class="block hover:text-primary" href="#">Historical</a>
<a class="block hover:text-primary" href="#">Horror</a>
<a class="block hover:text-primary" href="#">Isekai</a>
<a class="block hover:text-primary" href="#">Josei</a>
<a class="block hover:text-primary" href="#">Kids</a>
<a class="block hover:text-primary" href="#">Magic</a>
<a class="block hover:text-primary" href="#">Martial Arts</a>
<a class="block hover:text-primary" href="#">Mecha</a>
<a class="block hover:text-primary" href="#">Military</a>
<a class="block hover:text-primary" href="#">Music</a>
<a class="block hover:text-primary" href="#">Mystery</a>
<a class="block hover:text-primary" href="#">Noir</a>
<a class="block hover:text-primary" href="#">Parody</a>
<a class="block hover:text-primary" href="#">Police</a>
<a class="block hover:text-primary" href="#">Psychological</a>
<a class="block hover:text-primary" href="#">Politic</a>
<a class="block hover:text-primary" href="#">Romance</a>
<a class="block hover:text-primary" href="#">Reality-Show</a>
<a class="block hover:text-primary" href="#">Reality-TV</a>
<a class="block hover:text-primary" href="#">Samurai</a>
<a class="block hover:text-primary" href="#">School</a>
<a class="block hover:text-primary" href="#">Sci-Fi</a>
<a class="block hover:text-primary" href="#">Seinen</a>
<a class="block hover:text-primary" href="#">Shoujo</a>
<a class="block hover:text-primary" href="#">Shoujo Ai</a>
<a class="block hover:text-primary" href="#">Shounen</a>
<a class="block hover:text-primary" href="#">Shounen Ai</a>
<a class="block hover:text-primary" href="#">Slice of Life</a>
<a class="block hover:text-primary" href="#">Space</a>
<a class="block hover:text-primary" href="#">Sports</a>
<a class="block hover:text-primary" href="#">Super Power</a>
<a class="block hover:text-primary" href="#">Supernatural</a>
<a class="block hover:text-primary" href="#">Thriller</a>
<a class="block hover:text-primary" href="#">Vampire</a>
<a class="block hover:text-primary" href="#">War</a>
</div>
</div>
<div class="border-b border-gray-100 dark:border-gray-800">
<button class="flex items-center justify-between w-full text-base font-medium hover:text-primary focus:outline-none py-3" onclick="toggleMobileDropdown('country-mobile')">
<span>Country</span>
<span class="material-symbols-outlined text-sm transform transition-transform duration-200" id="country-arrow">expand_more</span>
</button>
<div class="hidden mt-1 mb-3 ml-2 grid grid-cols-2 gap-2 text-sm text-gray-500 dark:text-gray-400" id="country-mobile">
<a class="block hover:text-primary" href="#">Afghanistan</a>
<a class="block hover:text-primary" href="#">Algeria</a>
<a class="block hover:text-primary" href="#">Argentina</a>
<a class="block hover:text-primary" href="#">Australia</a>
<a class="block hover:text-primary" href="#">Austria</a>
<a class="block hover:text-primary" href="#">Bangladesh</a>
<a class="block hover:text-primary" href="#">Belgium</a>
<a class="block hover:text-primary" href="#">Brazil</a>
<a class="block hover:text-primary" href="#">Canada</a>
<a class="block hover:text-primary" href="#">Chile</a>
<a class="block hover:text-primary" href="#">China</a>
<a class="block hover:text-primary" href="#">Colombia</a>
<a class="block hover:text-primary" href="#">Czechia</a>
<a class="block hover:text-primary" href="#">Denmark</a>
<a class="block hover:text-primary" href="#">Egypt</a>
<a class="block hover:text-primary" href="#">Finland</a>
<a class="block hover:text-primary" href="#">France</a>
<a class="block hover:text-primary" href="#">Germany</a>
<a class="block hover:text-primary" href="#">Greece</a>
<a class="block hover:text-primary" href="#">Hong Kong</a>
<a class="block hover:text-primary" href="#">Hungary</a>
<a class="block hover:text-primary" href="#">Iceland</a>
<a class="block hover:text-primary" href="#">India</a>
<a class="block hover:text-primary" href="#">Indonesia</a>
<a class="block hover:text-primary" href="#">Iran</a>
<a class="block hover:text-primary" href="#">Ireland</a>
<a class="block hover:text-primary" href="#">Israel</a>
<a class="block hover:text-primary" href="#">Italy</a>
<a class="block hover:text-primary" href="#">Japan</a>
<a class="block hover:text-primary" href="#">Mexico</a>
<a class="block hover:text-primary" href="#">Netherlands</a>
<a class="block hover:text-primary" href="#">New Zealand</a>
<a class="block hover:text-primary" href="#">Nigeria</a>
<a class="block hover:text-primary" href="#">Pakistan</a>
<a class="block hover:text-primary" href="#">Philippines</a>
<a class="block hover:text-primary" href="#">Poland</a>
<a class="block hover:text-primary" href="#">Russia</a>
<a class="block hover:text-primary" href="#">South Africa</a>
<a class="block hover:text-primary" href="#">Spain</a>
<a class="block hover:text-primary" href="#">Sweden</a>
<a class="block hover:text-primary" href="#">Taiwan</a>
<a class="block hover:text-primary" href="#">Thailand</a>
<a class="block hover:text-primary" href="#">Turkey</a>
<a class="block hover:text-primary" href="#">UK</a>
<a class="block hover:text-primary" href="#">USA</a>
</div>
</div>
<a class="block text-base font-medium hover:text-primary py-3 border-b border-gray-100 dark:border-gray-800" href="#">Top IMdb</a>
<a class="block text-base font-medium hover:text-primary py-3 border-b border-gray-100 dark:border-gray-800" href="#">Updates</a>
<a class="block text-base font-medium hover:text-primary py-3 border-b border-gray-100 dark:border-gray-800" href="https://editor.wix.com/wixel-view/forms/7405900275916997729">Sent Request</a>
</div>
</div>
<header class="fixed top-0 w-full z-40 bg-white/95 dark:bg-[#0B0E19]/95 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800 shadow-sm">
<div class="container mx-auto px-4 h-16 flex items-center justify-between relative">
<div class="flex items-center gap-4">
<button class="lg:hidden text-gray-600 dark:text-gray-200 focus:outline-none" onclick="toggleMobileMenu()">
<span class="material-symbols-outlined text-3xl">menu</span>
</button>
<nav class="hidden lg:flex items-center space-x-6 text-sm font-medium">
<a class="hover:text-primary transition-colors text-gray-700 dark:text-gray-200" href="#">Home</a>
<div class="relative group">
<button class="flex items-center space-x-1 hover:text-primary transition-colors focus:outline-none py-5 text-gray-700 dark:text-gray-200">
<span>Genre</span>
<span class="material-symbols-outlined text-sm group-hover:rotate-180 transition-transform">expand_more</span>
</button>
<div class="absolute top-full left-0 w-[600px] bg-[#151926] border border-gray-800 rounded-b-xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 p-6 z-50 transform origin-top translate-y-2 group-hover:translate-y-0">
<div class="grid grid-cols-4 gap-y-3 gap-x-6">
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Adult</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Cars</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Comedy</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Dementia</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Demons</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Drama</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Ecchi</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Fantasy</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Game</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Harem</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Historical</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Horror</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Isekai</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Josei</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Kids</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Magic</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Martial Arts</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Mecha</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Military</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Music</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Mystery</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Parody</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Police</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Politic</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Psychological</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Romance</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Samurai</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">School</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Sci-Fi</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Seinen</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Shoujo</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Shoujo Ai</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Shounen</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Shounen Ai</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Slice of Life</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Space</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Sports</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Super Power</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Supernatural</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Thriller</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">Vampire</a>
<a class="hover:text-primary block text-sm text-gray-600 dark:text-gray-400" href="#">War</a>
</div>
</div>
</div>
<div class="relative group">
<button class="flex items-center space-x-1 hover:text-primary transition-colors focus:outline-none py-5 text-gray-700 dark:text-gray-200">
<span>Country</span>
<span class="material-symbols-outlined text-sm group-hover:rotate-180 transition-transform">expand_more</span>
</button>
<div class="absolute top-full left-0 w-[600px] bg-[#151926] border border-gray-800 rounded-b-xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 p-6 z-50 transform origin-top translate-y-2 group-hover:translate-y-0">
<div class="grid grid-cols-4 gap-y-3 gap-x-6">
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Argentina</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Australia</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Austria</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Belgium</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Brazil</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Canada</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">China</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Colombia</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Czech Republic</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Denmark</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Finland</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">France</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Germany</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Hong Kong</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Hungary</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">India</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Ireland</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Israel</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Italy</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Japan</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Luxembourg</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Mexico</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Netherlands</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">New Zealand</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Nigeria</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Norway</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Philippines</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Poland</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Romania</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Russia</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">South Africa</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">South Korea</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Spain</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Sweden</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Switzerland</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Taiwan</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Thailand</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">Turkey</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">United Kingdom</a>
<a class="text-gray-400 hover:text-primary text-sm transition-colors" href="#">United States</a>
</div>
</div>
</div>
<a class="hover:text-primary transition-colors text-gray-700 dark:text-gray-200" href="#">Top IMDb</a>
<a class="hover:text-primary transition-colors text-gray-700 dark:text-gray-200" href="#">Updates</a>
<a class="hover:text-primary transition-colors text-gray-700 dark:text-gray-200" href="https://editor.wix.com/wixel-view/forms/7405900275916997729">Sent Request</a>
</nav>
</div>
<div class="absolute left-1/2 transform -translate-x-1/2">
<a class="flex-shrink-0" href="/">
<img alt="Quravel Logo" class="h-8 md:h-10 object-contain" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDXN3Hca3aWuGXtAbGxqQetPT522nNIBOg8RIjyziH6DgWG1mCTHDBPTao5XsjL8w8YYRVT609JpnQcZYrYrz2BrXdcEwxEHs4FjwLpWao87awQ2ITZSp_mKq4hYsfpo2vGQ0chZtQX1Q8bZFFuZVc5e-qapTaRnRhNPUXW4LPkZV8HfOrMTfcBAQGyDW-2X27GvaNvkq10et6LTlDY7N4eLzy71hMCGFPumK2bSs13laqeYRhYX1GI6lpaRPweUyIJUWiny3_If0I"/>
</a>
</div>
<div class="flex items-center">
<!-- Desktop Search Bar -->
<div class="hidden lg:block relative max-w-xl mx-auto w-full px-4">
    <div class="flex items-center bg-surface-dark rounded-full px-5 py-2 border border-gray-700 focus-within:border-primary transition">
        <span class="material-symbols-outlined text-gray-400 mr-3">search</span>
        <input type="text" id="nav-search-input" placeholder="Search movies, anime..." 
               class="bg-transparent border-none focus:ring-0 w-full text-white outline-none py-2 text-sm">
    </div>
    
    <div id="nav-search-dropdown" class="absolute hidden w-[calc(100%-2rem)] left-4 bg-surface-dark mt-2 rounded-xl shadow-2xl z-[100] overflow-hidden border border-gray-700">
        <div id="nav-suggestions-list" class="max-h-96 overflow-y-auto"></div>
        <a id="nav-view-all-btn" href="/search" class="block w-full text-center p-3 bg-primary text-white font-bold hover:bg-opacity-90 transition text-sm">
            View All Results
        </a>
    </div>
</div>

<!-- Mobile Search Button -->
<button class="lg:hidden text-gray-600 dark:text-gray-200 ml-4" onclick="toggleMobileSearch()">
<span class="material-symbols-outlined">search</span>
</button>
</div>
</div>
<!-- Mobile Search Bar -->
<div class="hidden lg:hidden bg-white dark:bg-[#0B0E19] border-b border-gray-200 dark:border-gray-800 p-4 absolute w-full top-16 left-0 z-30" id="mobile-search-bar">
<div class="relative max-w-full mx-auto">
    <div class="flex items-center bg-surface-dark rounded-full px-5 py-2 border border-gray-700 focus-within:border-primary transition">
        <span class="material-symbols-outlined text-gray-400 mr-3">search</span>
        <input type="text" id="mobile-search-input" placeholder="Search movies, anime..." 
               class="bg-transparent border-none focus:ring-0 w-full text-white outline-none py-2 text-sm">
    </div>
    
    <div id="mobile-search-dropdown" class="absolute hidden w-full bg-surface-dark mt-2 rounded-xl shadow-2xl z-[100] overflow-hidden border border-gray-700">
        <div id="mobile-suggestions-list" class="max-h-80 overflow-y-auto"></div>
        <a id="mobile-view-all-btn" href="/search" class="block w-full text-center p-3 bg-primary text-white font-bold hover:bg-opacity-90 transition text-sm">
            View All Results
        </a>
    </div>
</div>
</div>
</header>
<main class="flex-grow pt-16 pb-24 lg:pb-12 bg-[#0B0E14]">
<!-- 11ty Template Integration Start -->
{% if post %}
<div class="container mx-auto px-4 lg:px-0">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 player-container">
        <!-- Left Column - Video Player (Top Center) -->
        <div class="lg:col-span-2">
            <div class="aspect-video bg-black rounded-xl overflow-hidden shadow-2xl">
                <iframe id="main-player" src="" class="w-full h-full" allowfullscreen></iframe>
            </div>

            <div class="flex gap-4 mt-6 p-4 bg-surface-dark rounded-lg">
                <span class="text-gray-400 self-center mr-2">Server:</span>
                <button onclick="setServer('sub')" id="btn-sub" class="server-btn bg-primary px-6 py-2 rounded font-bold">Sub</button>
                <button onclick="setServer('dub')" id="btn-dub" class="server-btn bg-gray-800 px-6 py-2 rounded font-bold">Dub</button>
                <button onclick="setServer('raw')" id="btn-raw" class="server-btn bg-gray-800 px-6 py-2 rounded font-bold">Raw</button>
            </div>
            
            <!-- Movie Content (if type is movie) -->
            {% if post.type == 'movie' %}
            <div class="mt-8 bg-surface-dark rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-white">{{ post.title }}</h2>
                    <span class="text-[10px] bg-primary/20 text-primary px-2 py-0.5 rounded uppercase tracking-widest font-bold">
                        {{ post.status | default('HD') }}
                    </span>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    {% if post.genres %}
                        {% for genre in post.genres %}
                        <span class="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded">{{ genre }}</span>
                        {% endfor %}
                    {% endif %}
                </div>
                <p class="text-gray-300 text-sm">{{ post.description | default('No description available.') }}</p>
            </div>
            {% endif %}
        </div>

        <!-- Right Column - Episodes/Seasons -->
        <div class="space-y-8">
            <!-- Episodes Section -->
            {% if post.type == 'series' %}
            <div class="bg-surface-dark rounded-xl p-4 md:p-6 border border-gray-800">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-white">Episodes</h2>
                    <span class="text-[10px] bg-primary/20 text-primary px-2 py-0.5 rounded uppercase tracking-widest font-bold">
                        {{ post.status | default('Ongoing') }}
                    </span>
                </div>

                {% if post.seasons and post.seasons.length > 1 %}
                <div class="mb-4">
                    <div class="relative">
                        <select id="season-select" onchange="changeSeason(this.value)" 
                                class="w-full bg-background-dark border border-gray-700 rounded-lg py-2.5 px-4 text-sm text-white appearance-none focus:border-primary outline-none transition-colors">
                            {% for season in post.seasons %}
                                <option value="{{ loop.index0 }}">Season {{ season.seasonNumber }}</option>
                            {% endfor %}
                        </select>
                        <span class="material-symbols-outlined absolute right-3 top-2.5 text-gray-500 pointer-events-none">expand_more</span>
                    </div>
                </div>
                {% endif %}

                <div id="episode-container" class="space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                    <!-- Episodes will be rendered here by JavaScript -->
                </div>
            </div>
            {% endif %}

           <!-- Most Popular Section (Connected to 11ty) -->
<div class="bg-[#151926] rounded-xl p-4 border border-gray-800">
    <h3 class="text-white font-bold mb-4 text-lg">Most Popular</h3>
    <div class="space-y-4" id="most-popular-list">
        {% set popularShows = collections.popularShows or [] %}
        {% if popularShows.length > 0 %}
            {% for show in popularShows | slice(0, 5) %}
            <a class="flex gap-3 group" href="/post/{{ show.data.title | slugify }}/">
                <div class="w-16 h-20 rounded-md overflow-hidden flex-shrink-0">
                    <img class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" 
                         src="{{ show.data.poster }}" 
                         alt="{{ show.data.title }}"
                         onerror="this.src='https://via.placeholder.com/64x80?text=No+Image'"/>
                </div>
                <div class="flex flex-col justify-center flex-1">
                    <h4 class="text-white font-medium text-sm line-clamp-1 group-hover:text-primary transition-colors">
                        {{ show.data.title }}
                    </h4>
                    <div class="flex items-center gap-2 mt-2">
                        <span class="bg-green-500/20 text-green-400 text-[10px] px-1.5 py-0.5 rounded flex items-center gap-1">
                            <span class="material-symbols-outlined text-[10px]">visibility</span> 
                            {{ show.data.views | default('1.2K') }}
                        </span>
                        <span class="text-gray-500 text-xs">â€¢ {{ show.data.type | default('TV') }}</span>
                    </div>
                </div>
                <span class="material-symbols-outlined text-gray-600 self-center">add</span>
            </a>
            {% endfor %}
        {% else %}
            <!-- Fallback if no popularShows data -->
            <div class="text-gray-500 text-sm text-center py-4">No popular shows available</div>
        {% endif %}
    </div>
</div>

            <!-- Recommended for You Section (Connected to 11ty) -->
<div class="bg-[#151926] rounded-xl p-4 border border-gray-800">
    <h3 class="text-white font-bold mb-4 text-lg">Recommended for you</h3>
    <div class="grid grid-cols-3 gap-2" id="recommended-list">
        {% set recommendedShows = collections.recommendedShows or [] %}
        {% if recommendedShows.length > 0 %}
            {% for show in recommendedShows | slice(0, 6) %}
            <a href="/post/{{ show.data.title | slugify }}/" class="group cursor-pointer">
                <div class="relative aspect-[2/3] rounded-lg overflow-hidden mb-2">
                    <img class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" 
                         src="{{ show.data.poster }}" 
                         alt="{{ show.data.title }}"
                         onerror="this.src='https://via.placeholder.com/150x225?text=No+Image'"/>
                    <div class="absolute top-1 right-1 bg-primary/90 text-white text-[9px] font-bold px-1 rounded">HD</div>
                    <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/80 to-transparent p-1">
                        <span class="text-white text-[10px]">
                            {% if show.data.type == 'movie' %}
                                Movie
                            {% else %}
                                {{ show.data.episodeCount | default('12') }} Eps
                            {% endif %}
                        </span>
                    </div>
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                        <span class="material-symbols-outlined text-white text-3xl">play_circle</span>
                    </div>
                </div>
                <h4 class="text-white text-xs font-semibold line-clamp-1 group-hover:text-primary">{{ show.data.title }}</h4>
                <div class="flex justify-between text-[10px] text-gray-500">
                    <span>{% if show.data.type == 'movie' %}Movie{% else %}TV{% endif %}</span>
                    <span>{{ show.data.duration | default('24m') }}</span>
                </div>
            </a>
            {% endfor %}
        {% else %}
            <!-- Fallback if no recommendedShows data -->
            <div class="col-span-3 text-gray-500 text-sm text-center py-4">No recommendations available</div>
        {% endif %}
    </div>
</div>
        </div>
    </div>

    <!-- Additional Content (Comments, Rating, etc.) -->
    {% if post.type == 'series' %}
    <div class="mt-8 border-t border-gray-800 pt-8">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-4">
                <h3 class="text-primary text-xl font-bold">Comments</h3>
                <span class="text-gray-500 text-sm" id="comment-count">0 Comments</span>
            </div>
            <div class="flex items-center gap-4">
                <a class="text-xs text-white border border-gray-700 px-2 py-1 rounded hover:border-primary" href="#">Community Guidelines</a>
            </div>
        </div>
        <div class="flex gap-4 mb-8">
            <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold flex-shrink-0">G</div>
            <div class="flex-1 relative">
                <textarea class="w-full bg-[#151926] border border-gray-700 rounded-lg p-3 text-gray-300 focus:outline-none focus:border-primary h-24 resize-none" id="comment-input" maxlength="500" placeholder="Leave a public comment..."></textarea>
                <div class="flex justify-between items-center mt-2">
                    <span class="text-xs text-gray-500 ml-1" id="char-counter">500 characters remaining</span>
                    <button class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded text-sm font-semibold transition-colors" onclick="postComment()">Post Comment</button>
                </div>
            </div>
        </div>
        <div class="space-y-6" id="comments-container">
        </div>
    </div>
    {% endif %}
</div>

<script>
    // This data comes from your posts.json via 11ty (now direct array)
    {% if post %}
    const postData = {{ post | json | safe }};
    {% else %}
    const postData = {};
    {% endif %}
    let currentSeasonIdx = 0; // Default to the first season
    let currentServer = 'sub';
    let currentEpisodeIdx = 0;

    function initStreaming() {
        // If it's a series, render the first season's episodes
        if (postData.type === 'series' && postData.seasons && postData.seasons.length > 0) {
            renderEpisodes(currentSeasonIdx);
            if (postData.seasons.length === 1) {
                // Hide season selector if only one season
                const seasonSelect = document.getElementById('season-select');
                if (seasonSelect) {
                    seasonSelect.parentElement.classList.add('hidden');
                }
            }
        } else if (postData.type === 'movie') {
            // Just load the movie link directly
            loadMovie();
        }
        // Initialize player with first episode
        updatePlayer();
    }

    function renderEpisodes(sIdx) {
        const container = document.getElementById('episode-container');
        if (!container || !postData.seasons || !postData.seasons[sIdx]) return;
        
        const episodes = postData.seasons[sIdx].episodes;
        
        container.innerHTML = episodes.map(ep => `
            <button onclick="playEpisode(${ep.number - 1})" class="w-full flex items-center p-3 rounded-lg bg-background-dark/50 hover:bg-primary/10 border border-gray-800 hover:border-primary/30 transition-all text-left group">
                <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs font-bold mr-3 group-hover:text-primary">
                    ${ep.number}
                </div>
                <div class="flex-1 truncate">
                    <p class="text-sm font-medium truncate">${ep.title || 'Episode ' + ep.number}</p>
                    <p class="text-[10px] text-gray-500">${ep.duration || '24m'}</p>
                </div>
            </button>
        `).join('');
    }

    function playEpisode(epIdx) {
        currentEpisodeIdx = epIdx;
        updatePlayer();
        
        // Update active state in UI
        const buttons = document.querySelectorAll('#episode-container button');
        buttons.forEach((btn, idx) => {
            if (idx === epIdx) {
                btn.classList.add('bg-primary/20', 'border-primary/50');
                btn.classList.remove('bg-background-dark/50', 'hover:bg-primary/10');
            } else {
                btn.classList.remove('bg-primary/20', 'border-primary/50');
                btn.classList.add('bg-background-dark/50', 'hover:bg-primary/10');
            }
        });
    }

    function changeSeason(idx) {
        currentSeasonIdx = parseInt(idx);
        currentEpisodeIdx = 0; // Reset to first episode
        renderEpisodes(currentSeasonIdx);
        updatePlayer();
    }

    function updatePlayer() {
        const player = document.getElementById('main-player');
        if (!player) return;
        
        if (postData.type === 'movie') {
            // Load movie URL
            const movieUrl = postData.movieUrl || (postData.servers && postData.servers.sub) || '';
            if (movieUrl) {
                player.src = movieUrl;
            }
        } else if (postData.type === 'series' && postData.seasons && postData.seasons[currentSeasonIdx]) {
            const season = postData.seasons[currentSeasonIdx];
            const episode = season.episodes && season.episodes[currentEpisodeIdx];
            
            if (episode && episode.servers) {
                // Safety check if server type exists
                const streamUrl = episode.servers[currentServer] || Object.values(episode.servers)[0];
                if (streamUrl) {
                    player.src = streamUrl;
                }
            }
        }

        // Update Server Button UI
        document.querySelectorAll('.server-btn').forEach(btn => btn.classList.replace('bg-primary', 'bg-gray-800'));
        const serverBtn = document.getElementById(`btn-${currentServer}`);
        if (serverBtn) {
            serverBtn.classList.replace('bg-gray-800', 'bg-primary');
        }
    }

    function setServer(type) {
        currentServer = type;
        updatePlayer();
    }

    function loadMovie() {
        // Movie-specific initialization
        const playBtn = document.createElement('button');
        playBtn.className = 'bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-lg font-bold mt-4 transition-colors';
        playBtn.textContent = 'Watch Now';
        playBtn.onclick = updatePlayer;
        
        const container = document.getElementById('episode-container');
        if (container) {
            container.innerHTML = '';
            container.appendChild(playBtn);
        }
    }

    // Call on load
    document.addEventListener('DOMContentLoaded', initStreaming);
</script>
{% else %}
<!-- Original Content (for when 11ty data is not available) -->
<div class="container mx-auto px-0 lg:px-4 mt-0 lg:mt-6">
<div class="grid grid-cols-1 lg:grid-cols-[1fr_350px] gap-8">
<div class="flex flex-col space-y-6">
<div class="relative w-full aspect-video bg-black lg:rounded-xl overflow-hidden group select-none">
<img alt="Video Content" class="w-full h-full object-cover opacity-60" src="https://lh3.googleusercontent.com/aida-public/AB6AXuD_WkTZM5ZJ-NmTWR2UarTBAlvQ7P9ypGwIngTqhz3x53h75oR2QehaiVHXzaZ4EdTlD7DKAbSY7ijEe53JM_Qy1bCiQ3scMkoeKM9P21Jul1ZTTeMx413_PevdOcmb47ryU920sKnA0ByZk2G-iqk0KmNn00obvswj1ep1sci1GkIQQ-ubl71d6VMhb-nRWkRCP4MgrN6zw5y4oW0kuIIRp48E3CwPOGW8HgQ-oHGsUk5CKPiXemUd6XhmHr4YMs6lRbqCLMOQLck"/>
<div class="absolute bottom-16 w-full text-center px-4 z-10">
<p class="text-white text-sm lg:text-lg font-medium drop-shadow-md bg-black/50 inline-block px-2 rounded">I will make a rational choice based on justice.</p>
</div>
<div class="absolute inset-0 flex flex-col justify-between p-4 video-overlay">
<div class="flex justify-between items-start text-white">
<div class="flex items-center gap-4">
<button class="hover:text-primary transition-colors"><span class="material-symbols-outlined text-3xl">arrow_back</span></button>
<div>
<h1 class="font-bold text-sm lg:text-lg line-clamp-1" id="video-title">Chainsaw Man - Episode 1</h1>
</div>
</div>
<div class="flex gap-4">
<button class="hover:text-primary"><span class="material-symbols-outlined">cast</span></button>
<button class="hover:text-primary"><span class="material-symbols-outlined">airplay</span></button>
</div>
</div>
<div class="absolute inset-0 flex items-center justify-center pointer-events-none">
<button class="pointer-events-auto text-white hover:text-primary transform transition-transform hover:scale-110">
<span class="material-symbols-outlined text-7xl lg:text-8xl drop-shadow-lg">play_circle</span>
</button>
</div>
<div class="flex flex-col gap-2 mb-1">
<div class="w-full h-1 bg-gray-600 rounded-full cursor-pointer relative group/progress">
<div class="absolute top-0 left-0 h-full bg-primary w-[35%] rounded-full z-10"></div>
<div class="absolute top-0 left-0 h-full bg-white/30 w-[60%] rounded-full"></div>
<div class="absolute top-1/2 -translate-y-1/2 left-[35%] w-3 h-3 bg-white rounded-full scale-0 group-hover/progress:scale-100 transition-transform z-20"></div>
</div>
<div class="flex justify-between items-center text-white mt-2">
<div class="flex items-center gap-4">
<button class="hover:text-primary"><span class="material-symbols-outlined">volume_up</span></button>
<span class="text-xs font-mono text-gray-300">09:21 / 24:00</span>
</div>
<div class="flex items-center gap-4 lg:gap-6">
<button class="hover:text-primary flex items-center gap-1 text-xs font-medium"><span class="material-symbols-outlined">replay_10</span></button>
<button class="hover:text-primary flex items-center gap-1 text-xs font-medium"><span class="material-symbols-outlined">forward_10</span></button>
<button class="hover:text-primary bg-white/10 px-1 rounded text-xs font-bold border border-white/20">CC</button>
<button class="hover:text-primary"><span class="material-symbols-outlined">settings</span></button>
<button class="hover:text-primary"><span class="material-symbols-outlined">fullscreen</span></button>
</div>
</div>
</div>
</div>
</div>
<div class="px-4 lg:px-0 text-center">
<p class="text-gray-400 text-sm mb-1">You are watching</p>
<h2 class="text-xl lg:text-2xl font-bold text-white mb-2" id="main-series-title">Chainsaw Man <span class="text-primary font-normal text-lg ml-2" id="season-display">Season 1</span></h2>
<h3 class="text-lg font-bold text-white mb-2">Episode <span class="text-primary" id="current-ep-num">1</span></h3>
<div class="flex justify-center items-center gap-4 mb-4 mt-4 relative">
<button class="bg-[#1E2232] hover:bg-primary text-white px-4 py-2 rounded-lg flex items-center gap-1 text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" id="prev-ep-btn">
<span class="material-symbols-outlined text-sm">arrow_back_ios</span> Previous
                            </button>
<div class="relative">
<button class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium transition-colors shadow-lg shadow-primary/20" id="add-list-btn">
<span class="material-symbols-outlined text-sm">add_to_queue</span> Add to list
                                </button>
<div class="hidden absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-[#1E2232] border border-gray-700 rounded-lg shadow-xl z-50 overflow-hidden text-left" id="add-list-dropdown">
<button class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-primary hover:text-white transition-colors" onclick="setListStatus('Planning to watch')">Planning to watch</button>
<button class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-primary hover:text-white transition-colors" onclick="setListStatus('Watching')">Watching</button>
<button class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-primary hover:text-white transition-colors" onclick="setListStatus('Completed')">Completed</button>
<button class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-primary hover:text-white transition-colors" onclick="setListStatus('Re-watching')">Re-watching</button>
<button class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-primary hover:text-white transition-colors" onclick="setListStatus('Dropped')">Dropped</button>
<div class="border-t border-gray-700 my-1"></div>
<button class="block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500 hover:text-white transition-colors" onclick="setListStatus('Remove')">Remove from list</button>
</div>
</div>
<button class="bg-[#1E2232] hover:bg-primary text-white px-4 py-2 rounded-lg flex items-center gap-1 text-sm font-medium transition-colors" id="next-ep-btn">
                                Next <span class="material-symbols-outlined text-sm">arrow_forward_ios</span>
</button>
</div>
<p class="text-xs text-gray-500 mb-6">If current server doesn't work please try other servers beside.</p>
<div class="bg-[#151926] p-4 rounded-xl border border-gray-800 space-y-4 text-left">
<div class="flex items-center gap-3">
<div class="flex items-center gap-2 w-16 text-gray-300 font-bold text-sm shrink-0">
<span class="bg-primary/20 text-primary px-1 rounded text-[10px]">CC</span> SUB:
                                </div>
<div class="flex-1 overflow-x-auto hide-scrollbar flex gap-2" id="server-row-sub">
<button class="server-btn active whitespace-nowrap px-4 py-1.5 rounded bg-primary text-white text-xs font-bold shadow-lg shadow-primary/20 transition-colors" onclick="selectServer('sub', 1)">HD-1</button>
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('sub', 2)">HD-2</button>
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('sub', 3)">HD-3</button>
</div>
</div>
<div class="flex items-center gap-3">
<div class="flex items-center gap-2 w-16 text-gray-300 font-bold text-sm shrink-0">
<span class="material-symbols-outlined text-sm text-primary">mic</span> DUB:
                                </div>
<div class="flex-1 overflow-x-auto hide-scrollbar flex gap-2" id="server-row-dub">
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('dub', 1)">HD-1</button>
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('dub', 2)">HD-2</button>
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('dub', 3)">HD-3</button>
</div>
</div>
<div class="flex items-center gap-3">
<div class="flex items-center gap-2 w-16 text-gray-300 font-bold text-sm shrink-0">
<span class="material-symbols-outlined text-sm text-primary">raw_on</span> RAW:
                                </div>
<div class="flex-1 overflow-x-auto hide-scrollbar flex gap-2" id="server-row-raw">
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('raw', 1)">HD-1</button>
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('raw', 2)">HD-2</button>
<button class="server-btn whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors" onclick="selectServer('raw', 3)">HD-3</button>
</div>
</div>
</div>
</div>
<div class="px-4 lg:px-0">
<h3 class="text-white font-semibold mb-4 text-base lg:text-lg">Watch more seasons of this anime</h3>
<div class="grid grid-cols-2 lg:grid-cols-4 gap-3" id="season-container">
<div class="season-card relative h-16 rounded-lg overflow-hidden group cursor-pointer ring-1 ring-primary/50" onclick="changeSeason('Season 1')">
<img class="w-full h-full object-cover opacity-50 group-hover:opacity-40 transition-opacity blur-[2px]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuD_WkTZM5ZJ-NmTWR2UarTBAlvQ7P9ypGwIngTqhz3x53h75oR2QehaiVHXzaZ4EdTlD7DKAbSY7ijEe53JM_Qy1bCiQ3scMkoeKM9P21Jul1ZTTeMx413_PevdOcmb47ryU920sKnA0ByZk2G-iqk0KmNn00obvswj1ep1sci1GkIQQ-ubl71d6VMhb-nRWkRCP4MgrN6zw5y4oW0kuIIRp48E3CwPOGW8HgQ-oHGsUk5CKPiXemUd6XhmHr4YMs6lRbqCLMOQLck"/>
<div class="absolute inset-0 bg-black/40 flex items-center justify-center">
<span class="text-primary font-bold text-sm drop-shadow-md season-text">Season 1</span>
</div>
</div>
<div class="season-card relative h-16 rounded-lg overflow-hidden group cursor-pointer" onclick="changeSeason('OVA')">
<img class="w-full h-full object-cover opacity-50 group-hover:opacity-40 transition-opacity blur-[2px]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAQuHQGvQ_ZZoK-oiSbgwo97jr7QFFH3CQTV4YftvqcQxC4_9RkO3yOI4S45-TkvUvjclsVmYlr63JlsvgNOpbcEoLT34baDWU9MAahaGe82TPRYm6GqoAKj-PGiB1AWQ2Nu0dJcW-sk0LdIs1309AfZTrVu8PwjEVk1epEnACp5FEfBbKlqxYFgXjdpCa4Uh-iU1n5wm-Cf_817M-GTjUumrzvWrZPr9XbA3e6QMRs1nxmfKDH0lDMxo9aV-X1us5xqsONCa1Z73Q"/>
<div class="absolute inset-0 bg-black/40 flex items-center justify-center">
<span class="text-white font-bold text-sm drop-shadow-md group-hover:text-primary transition-colors season-text">OVA</span>
</div>
</div>
<div class="season-card relative h-16 rounded-lg overflow-hidden group cursor-pointer" onclick="changeSeason('SP-1')">
<img class="w-full h-full object-cover opacity-50 group-hover:opacity-40 transition-opacity blur-[2px]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDqiUc86NAc2oPWF0jZS6ltVT0qDRUQLGYe-vsh90aCjNPCKRUYsR2joEXfq121iCQ1DMhEXbbjY-Rm6ydRKKVvOD7XCHpsnpYv4oUDQP6h-KZ9tUpwQb33LAseATibNSPDDxAViL3XAYheHWPQCau7pQCd7-XFT2YjY86y-DFUxv6SfYoh27gsa2-RiKjPMnhZfSvjYzFQSeYDzy64a_9Lmf5_NT9MkYffdzHclH1EyMht0psBW3wqnbmTFh6wbG5Xh4VXCnRWONM"/>
<div class="absolute inset-0 bg-black/40 flex items-center justify-center">
<span class="text-white font-bold text-sm drop-shadow-md group-hover:text-primary transition-colors season-text">SP-1</span>
</div>
</div>
<div class="season-card relative h-16 rounded-lg overflow-hidden group cursor-pointer" onclick="changeSeason('Season 2')">
<img class="w-full h-full object-cover opacity-50 group-hover:opacity-40 transition-opacity blur-[2px]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuB6aKroKe4_Hr_QOThhIQ1eSBsj6XHa6M1h1ij1beOOwYZsLuAKaEUwhzePp5w2e0ZiNq23ueXCujFcscvpvX5l0fSEO1JhKa6gwDDPDrdfapY86HeYs5fG_M99b926v37WwsUlyZ7ugSX23giOl25toAwGLS8wOeBXwUajaxUzaTcHC_Yh5fJqnnwy6HgEx_QviGDLtROQ6LVPu2Z1BRIxBOEdc9fz9ozk1sYgF_aWaLm0ZXBf9Mh7BLQkJKaAnfSKTVLxnnvAS1o"/>
<div class="absolute inset-0 bg-black/40 flex items-center justify-center">
<span class="text-white font-bold text-sm drop-shadow-md group-hover:text-primary transition-colors season-text">Season 2</span>
</div>
</div>
<div class="season-card relative h-16 rounded-lg overflow-hidden group cursor-pointer" onclick="changeSeason('SP-2')">
<img class="w-full h-full object-cover opacity-50 group-hover:opacity-40 transition-opacity blur-[2px]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAQuHQGvQ_ZZoK-oiSbgwo97jr7QFFH3CQTV4YftvqcQxC4_9RkO3yOI4S45-TkvUvjclsVmYlr63JlsvgNOpbcEoLT34baDWU9MAahaGe82TPRYm6GqoAKj-PGiB1AWQ2Nu0dJcW-sk0LdIs1309AfZTrVu8PwjEVk1epEnACp5FEfBbKlqxYFgXjdpCa4Uh-iU1n5wm-Cf_817M-GTjUumrzvWrZPr9XbA3e6QMRs1nxmfKDH0lDMxo9aV-X1us5xqsONCa1Z73Q"/>
<div class="absolute inset-0 bg-black/40 flex items-center justify-center">
<span class="text-white font-bold text-sm drop-shadow-md group-hover:text-primary transition-colors season-text">SP-2</span>
</div>
</div>
<div class="season-card relative h-16 rounded-lg overflow-hidden group cursor-pointer" onclick="changeSeason('Season 3')">
<img class="w-full h-full object-cover opacity-50 group-hover:opacity-40 transition-opacity blur-[2px]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCwH3f4VjulnnLYk8EgFSCiOqFs12q4ivPSqucW7P7k4uOAN3qXURGd7iOxByylKHLJhbpiobEV442fMLZHwobXplWdRez-c71bcZODHHIHORqZw97zdSx_JgA4Cdym9n6VMtpcJXo3o5jc7jvKx13nsU2frrHJ8wgbcRH1cHIY8n7jLkRIsYOLDQ1uZWoGe99Imz98f_X9qskRvSTRVJiiJKF_DtE-ce0qw825vrwhgb66FQM3e_ymqoB8eBbjLZ5HuUePqbU5kYg"/>
<div class="absolute inset-0 bg-black/40 flex items-center justify-center">
<span class="text-white font-bold text-sm drop-shadow-md season-text">Season 3</span>
</div>
</div>
</div>
</div>
<div class="px-4 lg:px-0">
<h3 class="text-white font-semibold mb-4 text-base lg:text-lg">List of episodes:</h3>
<div class="relative">
<input class="bg-[#151926] border border-gray-700 text-gray-300 text-xs rounded pl-3 pr-8 py-1.5 focus:outline-none focus:border-primary w-32" placeholder="Number of Ep" type="text"/>
<span class="material-symbols-outlined absolute right-2 top-1.5 text-gray-500 text-sm">search</span>
</div>
</div>
<div class="bg-[#151926] rounded-xl overflow-hidden border border-gray-800 max-h-[400px] overflow-y-auto custom-scrollbar mt-4" id="episode-list">
</div>
</div>
<div class="px-4 lg:px-0 mt-8 mb-4">
<div class="bg-gradient-to-r from-[#1F2333] to-[#151926] rounded-2xl p-6 border border-gray-800/50 flex flex-col md:flex-row justify-between items-center gap-4 relative overflow-hidden">
<div class="absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full blur-[80px] -z-0"></div>
<div class="flex items-center gap-4 z-10">
<div class="flex items-center gap-2">
<span class="text-yellow-400 text-3xl drop-shadow-md">â˜…</span>
<span class="text-white text-4xl font-extrabold" id="rating-score">6.3</span>
</div>
<div class="h-8 w-[1px] bg-gray-700 mx-2"></div>
<div class="flex flex-col">
<span class="text-white font-semibold text-lg">Rate this anime</span>
<span class="text-gray-400 text-xs" id="vote-count-display">1,245 votes</span>
</div>
</div>
<button class="z-10 bg-white text-black font-bold px-8 py-3 rounded-full hover:bg-gray-200 transition-all shadow-lg hover:shadow-xl hover:scale-105 active:scale-95" id="main-vote-btn" onclick="openVoteModal()">
                                Vote now
                            </button>
</div>
</div>
<div class="mt-8 border-t border-gray-800 pt-8 px-4 lg:px-0">
<div class="flex items-center justify-between mb-6">
<div class="flex items-center gap-4">
<h3 class="text-primary text-xl font-bold">Comments</h3>
<span class="text-gray-500 text-sm" id="comment-count-2">0 Comments</span>
</div>
<div class="flex items-center gap-4">
<a class="text-xs text-white border border-gray-700 px-2 py-1 rounded hover:border-primary" href="#">Community Guidelines</a>
</div>
</div>
<div class="flex gap-4 mb-8">
<div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold flex-shrink-0">G</div>
<div class="flex-1 relative">
<textarea class="w-full bg-[#151926] border border-gray-700 rounded-lg p-3 text-gray-300 focus:outline-none focus:border-primary h-24 resize-none" id="comment-input-2" maxlength="500" placeholder="Leave a public comment..."></textarea>
<div class="flex justify-between items-center mt-2">
<span class="text-xs text-gray-500 ml-1" id="char-counter-2">500 characters remaining</span>
<button class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded text-sm font-semibold transition-colors" onclick="postComment2()">Post Comment</button>
</div>
</div>
</div>
<div class="space-y-6" id="comments-container-2">
</div>
</div>
</div>
<div class="space-y-8 lg:sticky lg:top-24 h-fit mt-12 lg:mt-0">
<div class="bg-[#151926] rounded-xl p-4 border border-gray-800">
<h3 class="text-white font-bold mb-4 text-lg">Most Popular</h3>
<div class="space-y-4" id="most-popular-list-2">
</div>
</div>
<div>
<h3 class="text-white font-bold mb-4 text-lg">Recommended for you</h3>
<div class="grid grid-cols-3 gap-2" id="recommended-list-2">
</div>
</div>
</div>
</div>
</div>
{% endif %}
<!-- 11ty Template Integration End -->
</main>
<div class="fixed bottom-0 left-0 w-full z-30 sticky-vote bg-surface-dark/90 dark:bg-[#1A1D29]/80 border-t border-gray-800 p-4 pb-6 flex justify-between items-center lg:hidden">
<div class="flex items-center gap-2">
<span class="text-yellow-400 text-xl">â˜…</span>
<span class="text-white text-2xl font-bold" id="mobile-rating-score">6.3</span>
</div>
<button class="bg-white text-black font-bold px-6 py-2 rounded-full hover:bg-gray-200 transition-colors" onclick="openVoteModal()">
            Vote now
        </button>
</div>
<div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/70 hidden transition-opacity" id="vote-modal">
<div class="bg-[#1F2333] w-full sm:w-[450px] rounded-t-2xl sm:rounded-2xl p-6 transform transition-transform animate-[slideUp_0.3s_ease-out] relative">
<button class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors" onclick="closeVoteModal()">
<span class="material-symbols-outlined text-2xl">close</span>
</button>
<div class="flex justify-between items-center mb-6">
<div class="flex items-center gap-3">
<span class="text-yellow-400 text-2xl">â˜…</span>
<span class="text-white text-3xl font-extrabold" id="modal-rating-score">6.3</span>
<span class="text-gray-400 text-sm ml-1" id="modal-vote-count">1,245 votes</span>
</div>
</div>
<p class="text-white text-center mb-8 text-xl font-semibold">What do you think about this anime?</p>
<div class="grid grid-cols-3 gap-4" id="vote-options">
<button class="bg-gray-200 hover:bg-gray-300 active:bg-gray-400 rounded-xl py-6 flex flex-col items-center gap-3 transition-all transform hover:-translate-y-1 group" onclick="submitVote('Boring')">
<span class="text-4xl group-hover:scale-110 transition-transform">ðŸ˜©</span>
<span class="text-black font-bold text-base">Boring</span>
</button>
<button class="bg-gray-200 hover:bg-gray-300 active:bg-gray-400 rounded-xl py-6 flex flex-col items-center gap-3 transition-all transform hover:-translate-y-1 group" onclick="submitVote('Great')">
<span class="text-4xl group-hover:scale-110 transition-transform">ðŸ˜ƒ</span>
<span class="text-black font-bold text-base">Great</span>
</button>
<button class="bg-gray-200 hover:bg-gray-300 active:bg-gray-400 rounded-xl py-6 flex flex-col items-center gap-3 transition-all transform hover:-translate-y-1 group" onclick="submitVote('Amazing')">
<span class="text-4xl group-hover:scale-110 transition-transform">ðŸ¤©</span>
<span class="text-black font-bold text-base">Amazing</span>
</button>
</div>
<div class="hidden text-center py-4" id="voted-state">
<div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-[fadeIn_0.5s_ease-out]">
<span class="material-symbols-outlined text-green-500 text-3xl">check</span>
</div>
<h3 class="text-white text-xl font-bold mb-2">Thanks for voting!</h3>
<p class="text-gray-400 text-sm">You rated this as <span class="text-primary font-bold" id="user-vote-selection"></span>.</p>
</div>
</div>
</div>
<!-- Search Functionality Script -->
<script>
    (function() {
        // Desktop search functionality
        const searchInput = document.getElementById('nav-search-input');
        const dropdown = document.getElementById('nav-search-dropdown');
        const suggestionsList = document.getElementById('nav-suggestions-list');
        const viewAllBtn = document.getElementById('nav-view-all-btn');
        
        // Mobile search functionality
        const mobileSearchInput = document.getElementById('mobile-search-input');
        const mobileDropdown = document.getElementById('mobile-search-dropdown');
        const mobileSuggestionsList = document.getElementById('mobile-suggestions-list');
        const mobileViewAllBtn = document.getElementById('mobile-view-all-btn');
        
        let searchDB = [];

        // 1. Fetch the data generated by 11ty (now expects direct array)
        fetch('/search-data.json')
            .then(res => res.json())
            .then(data => {
                searchDB = data;
                // If the data is a direct array, use it as-is
                if (!Array.isArray(searchDB)) {
                    console.warn('search-data.json is not an array, attempting to use as direct array...');
                    // If it's an object, try to use it as a direct array
                    // Check if it has array-like structure
                    if (searchDB && typeof searchDB === 'object') {
                        // Convert object values to array if needed
                        const values = Object.values(searchDB);
                        if (Array.isArray(values) && values.length > 0) {
                            searchDB = values;
                        } else {
                            console.error('Invalid search-data.json structure');
                            searchDB = [];
                        }
                    } else {
                        console.error('Invalid search-data.json structure');
                        searchDB = [];
                    }
                }
                
                // Ensure each item has the required fields for search
                searchDB = searchDB.map(item => ({
                    id: item.id || item.title.toLowerCase().replace(/\s+/g, '-'),
                    title: item.title || '',
                    type: item.type || 'movie',
                    year: item.year || 2023,
                    rating: item.rating || 0,
                    duration: item.duration || 'N/A',
                    genres: Array.isArray(item.genres) ? item.genres : [],
                    poster: item.poster || 'https://via.placeholder.com/300x450?text=Poster',
                    slug: item.slug || item.title.toLowerCase().replace(/\s+/g, '-'),
                    description: item.description || 'No description available.',
                    japaneseTitle: item.japaneseTitle || ''
                }));
            })
            .catch(err => {
                console.error('Error loading search data:', err);
                searchDB = [];
            });

        // Function to filter and display results
        function performSearch(query, suggestionsContainer, viewAllLink, dropdownElement) {
            if (query.length < 2) {
                dropdownElement.classList.add('hidden');
                return;
            }

            // Filter data and limit to 6 results
            const matches = searchDB.filter(item => 
                item.title && item.title.toLowerCase().includes(query) || 
                (item.japaneseTitle && item.japaneseTitle.toLowerCase().includes(query))
            ).slice(0, 6);

            if (matches.length > 0) {
                dropdownElement.classList.remove('hidden');
                
                // Update the "View All" link
                viewAllLink.href = `/search/?q=${encodeURIComponent(query)}`;
                
                // Build the HTML for suggestions
                suggestionsContainer.innerHTML = matches.map(item => {
                    // Create the slug for the link - use the item's slug if available
                    const slug = item.slug || item.title.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]+/g, '');
                    const posterUrl = item.poster || 'https://via.placeholder.com/48x64?text=No+Image';
                    
                    return `
                    <a href="/post/${slug}/" class="flex items-center p-3 hover:bg-gray-800 transition border-b border-gray-700">
                        <img src="${posterUrl}" class="w-12 h-16 object-cover rounded shadow mr-4" 
                             onerror="this.src='https://via.placeholder.com/48x64?text=No+Image'">
                        <div class="flex-1 overflow-hidden">
                            <h4 class="text-white font-bold text-sm truncate">${item.title || 'Untitled'}</h4>
                            <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-wider truncate">
                                ${item.type || 'N/A'} â€¢ ${item.genres && item.genres.length > 0 ? item.genres[0] : 'N/A'} â€¢ ${item.year || 'N/A'} â€¢ ${item.duration || 'N/A'}
                            </p>
                        </div>
                        <span class="material-symbols-outlined text-gray-600 text-sm">chevron_right</span>
                    </a>
                    `;
                }).join('');
            } else {
                dropdownElement.classList.add('hidden');
            }
        }

        // 2. Listen for user input on desktop
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                performSearch(query, suggestionsList, viewAllBtn, dropdown);
            });
            
            // Close dropdown when search input loses focus
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    dropdown.classList.add('hidden');
                }, 200);
            });
        }

        // 3. Listen for user input on mobile
        if (mobileSearchInput) {
            mobileSearchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                performSearch(query, mobileSuggestionsList, mobileViewAllBtn, mobileDropdown);
            });
            
            // Close dropdown when search input loses focus
            mobileSearchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    mobileDropdown.classList.add('hidden');
                }, 200);
            });
        }

        // Close dropdown if user clicks outside (desktop)
        if (dropdown) {
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
        }

        // Close dropdown if user clicks outside (mobile)
        if (mobileDropdown) {
            document.addEventListener('click', (e) => {
                if (mobileSearchInput && !mobileSearchInput.contains(e.target) && !mobileDropdown.contains(e.target)) {
                    mobileDropdown.classList.add('hidden');
                }
            });
        }
    })();
</script>

<!-- Original Script (for when 11ty data is not available) -->
<script>
    // State
    let currentEp = 1;
    let currentSeason = 'Season 1';
    const totalEps = 12;
    // --- Data Population (Simulating Content) ---
    const popularItems = [
        { title: "One Piece", views: "1152", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuCwH3f4VjulnnLYk8EgFSCiOqFs12q4ivPSqucW7P7k4uOAN3qXURGd7iOxByylKHLJhbpiobEV442fMLZHwobXplWdRez-c71bcZODHHIHORqZw97zdSx_JgA4Cdym9n6VMtpcJXo3o5jc7jvKx13nsU2frrHJ8wgbcRH1cHIY8n7jLkRIsYOLDQ1uZWoGe99Imz98f_X9qskRvSTRVJiiJKF_DtE-ce0qw825vrwhgb66FQM3e_ymqoB8eBbjLZ5HuUePqbU5kYg" },
        { title: "Chainsaw Man", views: "940", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuAQuHQGvQ_ZZoK-oiSbgwo97jr7QFFH3CQTV4YftvqcQxC4_9RkO3yOI4S45-TkvUvjclsVmYlr63JlsvgNOpbcEoLT34baDWU9MAahaGe82TPRYm6GqoAKj-PGiB1AWQ2Nu0dJcW-sk0LdIs1309AfZTrVu8PwjEVk1epEnACp5FEfBbKlqxYFgXjdpCa4Uh-iU1n5wm-Cf_817M-GTjUumrzvWrZPr9XbA3e6QMRs1nxmfKDH0lDMxo9aV-X1us5xqsONCa1Z73Q" },
        { title: "Jujutsu Kaisen", views: "880", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuDqiUc86NAc2oPWF0jZS6ltVT0qDRUQLGYe-vsh90aCjNPCKRUYsR2joEXfq121iCQ1DMhEXbbjY-Rm6ydRKKVvOD7XCHpsnpYv4oUDQP6h-KZ9tUpwQb33LAseATibNSPDDxAViL3XAYheHWPQCau7pQCd7-XFT2YjY86y-DFUxv6SfYoh27gsa2-RiKjPMnhZfSvjYzFQSeYDzy64a_9Lmf5_NT9MkYffdzHclH1EyMht0psBW3wqnbmTFh6wbG5Xh4VXCnRWONM" },
        { title: "Bleach", views: "750", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" },
        { title: "Naruto", views: "1200", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" },
        { title: "Demon Slayer", views: "999", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBJUVSMqcvlsLRod5Xj-MZhjFAWxv45A-9D1r1RCogjetrU2yKas3rRIuvSZRytOe6KmnI1y8NBGlIDGaE0UV5-mx19YpDf5v0SsajVxTc0VUCDku8E8PC54rDIUGGhmt44NSDXMGfnGVTtfzGJ8Cj6U15erHms74L8zDNtfVtIjG013mT9k-H5Psf5KSd570YR8_DAtEfUBmcVIMfE5LNH3WO14T7Cv3psWjV5O4UWogAMASg1czrkMA4qcRagH2Mtb7wqzWRn0BQ" },
        { title: "Spy x Family", views: "850", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuAyQkhWkWRKHdBKcKeKIQPSp0dqUxzkKXlQI9e-linyzdZc9vxD5aQvA-ZV_wOo7084k8eQ29HZJd3WqF6fhl5ywezJ9q4mrXm4IXYZnsrFWIdQpQGJRxxoSsAH0BJ7T_rXsfSDASTzBL9VkhWJq2VaqxNU8lIq-c1X5b8JBJP3GlTMQPDc7w1h4CxDMBAlzCY-SB1q84jFGtF6k7hS7VqPnzYc8hjOHgQWrprfsOoJEFcCFtN-N3rEH8TW-lRH0reqCAVonCPGynA" },
        { title: "Blue Lock", views: "670", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuCwH3f4VjulnnLYk8EgFSCiOqFs12q4ivPSqucW7P7k4uOAN3qXURGd7iOxByylKHLJhbpiobEV442fMLZHwobXplWdRez-c71bcZODHHIHORqZw97zdSx_JgA4Cdym9n6VMtpcJXo3o5jc7jvKx13nsU2frrHJ8wgbcRH1cHIY8n7jLkRIsYOLDQ1uZWoGe99Imz98f_X9qskRvSTRVJiiJKF_DtE-ce0qw825vrwhgb66FQM3e_ymqoB8eBbjLZ5HuUePqbU5kYg" }
    ];
    const recommendedItems = [
        { title: "Shawshank", eps: "12 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" },
        { title: "Breaking Bad", eps: "62 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" },
        { title: "GOT", eps: "73 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBJUVSMqcvlsLRod5Xj-MZhjFAWxv45A-9D1r1RCogjetrU2yKas3rRIuvSZRytOe6KmnI1y8NBGlIDGaE0UV5-mx19YpDf5v0SsajVxTc0VUCDku8E8PC54rDIUGGhmt44NSDXMGfnGVTtfzGJ8Cj6U15erHms74L8zDNtfVtIjG013mT9k-H5Psf5KSd570YR8_DAtEfUBmcVIMfE5LNH3WO14T7Cv3psWjV5O4UWogAMASg1czrkMA4qcRagH2Mtb7wqzWRn0BQ" },
        { title: "The Office", eps: "201 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuAyQkhWkWRKHdBKcKeKIQPSp0dqUxzkKXlQI9e-linyzdZc9vxD5aQvA-ZV_wOo7084k8eQ29HZJd3WqF6fhl5ywezJ9q4mrXm4IXYZnsrFWIdQpQGJRxxoSsAH0BJ7T_rXsfSDASTzBL9VkhWJq2VaqxNU8lIq-c1X5b8JBJP3GlTMQPDc7w1h4CxDMBAlzCY-SB1q84jFGtF6k7hS7VqPnzYc8hjOHgQWrprfsOoJEFcCFtN-N3rEH8TW-lRH0reqCAVonCPGynA" },
        { title: "Godfather", eps: "Movie", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuCwH3f4VjulnnLYk8EgFSCiOqFs12q4ivPSqucW7P7k4uOAN3qXURGd7iOxByylKHLJhbpiobEV442fMLZHwobXplWdRez-c71bcZODHHIHORqZw97zdSx_JgA4Cdym9n6VMtpcJXo3o5jc7jvKx13nsU2frrHJ8wgbcRH1cHIY8n7jLkRIsYOLDQ1uZWoGe99Imz98f_X9qskRvSTRVJiiJKF_DtE-ce0qw825vrwhgb66FQM3e_ymqoB8eBbjLZ5HuUePqbU5kYg" },
        { title: "12 Angry Men", eps: "Movie", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuAWDG7W-EHvCGO6AOk0LDv2cxGsetsdcPblclKS1wVK3MQv4Fj_GiJpDoSYDcNwJrCYOz29g-FhsQOo9O_1CP7dvKsW3GKE6JfGAq8LUCU3Vk8A-AgKIbpFT50VlqnKIa-bNWxP6wrMSM1bk0abtMKKSCUoY8e8NTUY4CGgfqqjZkW-eJP5--tz8pfc8XzVLKbfvPpA015qvL4RQQ1H4ozFhJNr3H2YwCAMneW3D-iySlLubqn9nb1Edu-hnxmvSEkNQh7snL7aGL0" },
        { title: "Dark", eps: "26 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" },
        { title: "Stranger Things", eps: "34 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" },
        { title: "The Wire", eps: "60 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBJUVSMqcvlsLRod5Xj-MZhjFAWxv45A-9D1r1RCogjetrU2yKas3rRIuvSZRytOe6KmnI1y8NBGlIDGaE0UV5-mx19YpDf5v0SsajVxTc0VUCDku8E8PC54rDIUGGhmt44NSDXMGfnGVTtfzGJ8Cj6U15erHms74L8zDNtfVtIjG013mT9k-H5Psf5KSd570YR8_DAtEfUBmcVIMfE5LNH3WO14T7Cv3psWjV5O4UWogAMASg1czrkMA4qcRagH2Mtb7wqzWRn0BQ" },
        { title: "Sopranos", eps: "86 Eps", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuAyQkhWkWRKHdBKcKeKIQPSp0dqUxzkKXlQI9e-linyzdZc9vxD5aQvA-ZV_wOo7084k8eQ29HZJd3WqF6fhl5ywezJ9q4mrXm4IXYZnsrFWIdQpQGJRxxoSsAH0BJ7T_rXsfSDASTzBL9VkhWJq2VaqxNU8lIq-c1X5b8JBJP3GlTMQPDc7w1h4CxDMBAlzCY-SB1q84jFGtF6k7hS7VqPnzYc8hjOHgQWrprfsOoJEFcCFtN-N3rEH8TW-lRH0reqCAVonCPGynA" },
        { title: "Interstellar", eps: "Movie", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuCwH3f4VjulnnLYk8EgFSCiOqFs12q4ivPSqucW7P7k4uOAN3qXURGd7iOxByylKHLJhbpiobEV442fMLZHwobXplWdRez-c71bcZODHHIHORqZw97zdSx_JgA4Cdym9n6VMtpcJXo3o5jc7jvKx13nsU2frrHJ8wgbcRH1cHIY8n7jLkRIsYOLDQ1uZWoGe99Imz98f_X9qskRvSTRVJiiJKF_DtE-ce0qw825vrwhgb66FQM3e_ymqoB8eBbjLZ5HuUePqbU5kYg" },
        { title: "Inception", eps: "Movie", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuAWDG7W-EHvCGO6AOk0LDv2cxGsetsdcPblclKS1wVK3MQv4Fj_GiJpDoSYDcNwJrCYOz29g-FhsQOo9O_1CP7dvKsW3GKE6JfGAq8LUCU3Vk8A-AgKIbpFT50VlqnKIa-bNWxP6wrMSM1bk0abtMKKSCUoY8e8NTUY4CGgfqqjZkW-eJP5--tz8pfc8XzVLKbfvPpA015qvL4RQQ1H4ozFhJNr3H2YwCAMneW3D-iySlLubqn9nb1Edu-hnxmvSEkNQh7snL7aGL0" },
        { title: "Parasite", eps: "Movie", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" },
        { title: "Joker", eps: "Movie", img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBL8sSKQhkIHjJRpfaXPOb2Ntr-YMNUhdTfQQNGnnmqGZu3SSewBEFAnXpGTo1YxqHXlb8pOCJCZrgrSF00Ey3CMmhZW5Q7dqz5o0qIOeV3DXsmqV-RKQGF2yEnwCFPLqyZ1R9luYVGdw-P_L6bRKjMPRM2RO5ISubiOat46Ovv-uMFsJfxGzRT0ngWoCZXAiiHQbJOA91N5Wyn21gKPKb6rWilqbabiqUYqUEEe31UdFQXOki6b3glJcCnNMssztZkZ0UYU_mwBbY" }
    ];
    // --- Render Functions ---
    function renderPopular() {
        const container = document.getElementById('most-popular-list-2');
        if (!container) return;
        container.innerHTML = popularItems.map(item => `
            <a class="flex gap-3 group" href="/post/${item.title.toLowerCase().replace(/\s+/g, '-')}/">
                <div class="w-16 h-20 rounded-md overflow-hidden flex-shrink-0">
                    <img class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" src="${item.img}"/>
                </div>
                <div class="flex flex-col justify-center flex-1">
                    <h4 class="text-white font-medium text-sm line-clamp-1 group-hover:text-primary transition-colors">${item.title}</h4>
                    <div class="flex items-center gap-2 mt-2">
                        <span class="bg-green-500/20 text-green-400 text-[10px] px-1.5 py-0.5 rounded flex items-center gap-1"><span class="material-symbols-outlined text-[10px]">visibility</span> ${item.views}</span>
                        <span class="text-gray-500 text-xs">â€¢ TV</span>
                    </div>
                </div>
                <span class="material-symbols-outlined text-gray-600 self-center">add</span>
            </a>
        `).join('');
    }
    function renderRecommended() {
        const container = document.getElementById('recommended-list-2');
        if (!container) return;
        container.innerHTML = recommendedItems.map(item => `
            <a href="/post/${item.title.toLowerCase().replace(/\s+/g, '-')}/" class="group cursor-pointer">
                <div class="relative aspect-[2/3] rounded-lg overflow-hidden mb-2">
                    <img class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" src="${item.img}"/>
                    <div class="absolute top-1 right-1 bg-primary/90 text-white text-[9px] font-bold px-1 rounded">HD</div>
                    <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/80 to-transparent p-1">
                        <span class="text-white text-[10px]">${item.eps}</span>
                    </div>
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                        <span class="material-symbols-outlined text-white text-3xl">play_circle</span>
                    </div>
                </div>
                <h4 class="text-white text-xs font-semibold line-clamp-1 group-hover:text-primary">${item.title}</h4>
                <div class="flex justify-between text-[10px] text-gray-500">
                    <span>${item.eps.includes('Movie') ? 'Movie' : 'TV'}</span>
                    <span>22m</span>
                </div>
            </a>
        `).join('');
    }
    function renderEpisodeList() {
        const container = document.getElementById('episode-list');
        if (!container) return;
        let html = '';
        for (let i = 1; i <= totalEps; i++) {
            const isActive = i === currentEp;
            if (isActive) {
                html += `
                    <div class="flex justify-between items-center p-3 bg-primary/10 border-l-4 border-primary" id="ep-item-${i}">
                        <div class="flex items-center gap-4">
                            <span class="text-white font-bold w-6">${i}</span>
                            <span class="text-primary font-medium text-sm">Episode ${i}</span>
                        </div>
                        <span class="material-symbols-outlined text-primary text-xl">play_circle</span>
                    </div>
                `;
            } else {
                html += `
                    <div onclick="changeEpisode(${i})" class="flex justify-between items-center p-3 hover:bg-[#1E2232] border-b border-gray-800/50 transition-colors cursor-pointer group" id="ep-item-${i}">
                        <div class="flex items-center gap-4">
                            <span class="text-gray-500 font-bold w-6 group-hover:text-white">${i}</span>
                            <span class="text-gray-300 font-medium text-sm group-hover:text-white">Episode ${i}</span>
                        </div>
                    </div>
                `;
            }
        }
        container.innerHTML = html;
    }
    // --- Interaction Functions ---
    function changeEpisode(ep) {
        currentEp = ep;
        // Update UI text
        document.getElementById('current-ep-num').textContent = ep;
        document.getElementById('video-title').textContent = `Chainsaw Man ${currentSeason} - Episode ${ep}`;
        // Re-render list to show active state
        renderEpisodeList();
        // Update button states
        updateNavButtons();
    }
    function changeSeason(seasonName) {
        currentSeason = seasonName;
        currentEp = 1; // Reset to first episode of season
        // Update Display Text
        document.getElementById('season-display').textContent = seasonName;
        document.getElementById('video-title').textContent = `Chainsaw Man ${seasonName} - Episode 1`;
        document.getElementById('current-ep-num').textContent = 1;
        // Visual Selection Logic
        const cards = document.querySelectorAll('.season-card');
        cards.forEach(card => {
            // Remove active styles
            card.classList.remove('ring-1', 'ring-primary/50');
            const text = card.querySelector('.season-text');
            text.classList.remove('text-primary');
            text.classList.add('text-white');
            // Check if this card matches the new season
            // Simple check by text content
            if (text.textContent.trim() === seasonName) {
                card.classList.add('ring-1', 'ring-primary/50');
                text.classList.remove('text-white');
                text.classList.add('text-primary');
            }
        });
        // Re-render episodes (simulating new content)
        renderEpisodeList();
        updateNavButtons();
    }
    function updateNavButtons() {
        const prevBtn = document.getElementById('prev-ep-btn');
        const nextBtn = document.getElementById('next-ep-btn');
        if (prevBtn) prevBtn.disabled = currentEp <= 1;
        if (nextBtn) nextBtn.disabled = currentEp >= totalEps;
        // Add/remove click handlers to ensure latest state
        if (prevBtn) prevBtn.onclick = () => { if(currentEp > 1) changeEpisode(currentEp - 1); };
        if (nextBtn) nextBtn.onclick = () => { if(currentEp < totalEps) changeEpisode(currentEp + 1); };
    }
    function selectServer(type, id) {
        // Reset buttons in that row
        const row = document.getElementById(`server-row-${type}`);
        if (!row) return;
        const buttons = row.getElementsByTagName('button');
        for (let btn of buttons) {
            btn.className = "whitespace-nowrap px-4 py-1.5 rounded bg-[#1E2232] hover:bg-[#2A2E3B] text-gray-300 text-xs font-bold transition-colors";
        }
        const target = event.target;
        target.className = "whitespace-nowrap px-4 py-1.5 rounded bg-primary text-white text-xs font-bold shadow-lg shadow-primary/20 transition-colors";
        // In a real app, this would trigger a player source change
        console.log(`Switched to ${type.toUpperCase()} Server ${id}`);
    }
    // --- Add to List Logic ---
    const listBtn = document.getElementById('add-list-btn');
    const listDropdown = document.getElementById('add-list-dropdown');
    if (listBtn) {
        listBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            listDropdown.classList.toggle('hidden');
        });
    }
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (listBtn && !listBtn.contains(e.target) && !listDropdown.contains(e.target)) {
            listDropdown.classList.add('hidden');
        }
    });
    function setListStatus(status) {
        localStorage.setItem('animeWatchStatus', status);
        if (listDropdown) listDropdown.classList.add('hidden');
        // Update button text to reflect status
        if (listBtn) {
            if (status === 'Remove') {
                listBtn.innerHTML = '<span class="material-symbols-outlined text-sm">add_to_queue</span> Add to list';
                localStorage.removeItem('animeWatchStatus');
            } else {
                listBtn.innerHTML = `<span class="material-symbols-outlined text-sm">check</span> ${status}`;
            }
        }
    }
    // Initialize saved status
    const savedStatus = localStorage.getItem('animeWatchStatus');
    if (savedStatus && listBtn) {
        listBtn.innerHTML = `<span class="material-symbols-outlined text-sm">check</span> ${savedStatus}`;
    }
    // --- Comment Logic ---
    // Helper: Generate a simple unique ID
    function generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }
    // --- Char Counter Initialization ---
    const commentInput = document.getElementById('comment-input-2');
    const charCounter = document.getElementById('char-counter-2');
    const maxChars = 500;
    if (commentInput && charCounter) {
        commentInput.addEventListener('input', () => {
            const remaining = maxChars - commentInput.value.length;
            charCounter.textContent = `${remaining} characters remaining`;
        });
    }
    function loadComments() {
        const container = document.getElementById('comments-container-2');
        if (!container) return;
        // Load combined comments from storage or initialize with default
        let allComments = JSON.parse(localStorage.getItem('animeCommentsV2'));
        if (!allComments) {
            // Default comments with IDs and empty replies
            const defaultComments = [
                {
                    id: 'c1',
                    name: 'Rose',
                    color: 'text-yellow-500',
                    time: 'an hour ago',
                    text: 'This episode was absolutely fire! ðŸ”¥ The animation quality dropped a bit in the middle but the ending made up for it.',
                    avatar: 'https://lh3.googleusercontent.com/aida-public/AB6AXuD_WkTZM5ZJ-NmTWR2UarTBAlvQ7P9ypGwIngTqhz3x53h75oR2QehaiVHXzaZ4EdTlD7DKAbSY7ijEe53JM_Qy1bCiQ3scMkoeKM9P21Jul1ZTTeMx413_PevdOcmb47ryU920sKnA0ByZk2G-iqk0KmNn00obvswj1ep1sci1GkIQQ-ubl71d6VMhb-nRWkRCP4MgrN6zw5y4oW0kuIIRp48E3CwPOGW8HgQ-oHGsUk5CKPiXemUd6XhmHr4YMs6lRbqCLMOQLck',
                    likes: 12,
                    dislikes: 0,
                    userAction: null, // 'like', 'dislike', or null
                    replies: []
                },
                {
                    id: 'c2',
                    name: 'BookLion0374',
                    color: 'text-blue-400',
                    time: '4 hours ago',
                    text: 'Can anyone tell me the name of the OST playing at 14:20? It sounds so familiar.',
                    avatar: 'https://lh3.googleusercontent.com/aida-public/AB6AXuAQuHQGvQ_ZZoK-oiSbgwo97jr7QFFH3CQTV4YftvqcQxC4_9RkO3yOI4S45-TkvUvjclsVmYlr63JlsvgNOpbcEoLT34baDWU9MAahaGe82TPRYm6GqoAKj-PGiB1AWQ2Nu0dJcW-sk0LdIs1309AfZTrVu8PwjEVk1epEnACp5FEfBbKlqxYFgXjdpCa4Uh-iU1n5wm-Cf_817M-GTjUumrzvWrZPr9XbA3e6QMRs1nxmfKDH0lDMxo9aV-X1us5xqsONCa1Z73Q',
                    likes: 5,
                    dislikes: 0,
                    userAction: null,
                    replies: [
                        {
                            id: 'r2-1',
                            name: 'MusicLover',
                            color: 'text-purple-400',
                            time: '3 hours ago',
                            text: 'It is called "Edge of Chainsaw" by Kensuke Ushio.',
                            avatar: '',
                            likes: 2,
                            dislikes: 0,
                            userAction: null
                        }
                    ]
                },
                {
                    id: 'c3',
                    name: 'AnimeLover99',
                    color: 'text-green-400',
                    time: '5 hours ago',
                    text: 'Honestly, I expected more action. This felt like a filler episode to me. ðŸ˜´',
                    avatar: '',
                    likes: 0,
                    dislikes: 8,
                    userAction: null,
                    replies: []
                },
                {
                    id: 'c4',
                    name: 'DarkSlayer',
                    color: 'text-red-500',
                    time: '6 hours ago',
                    text: 'The fight scene at the beginning was insane! MAPPA really outdid themselves this time.',
                    avatar: '',
                    likes: 24,
                    dislikes: 1,
                    userAction: null,
                    replies: []
                },
                {
                    id: 'c5',
                    name: 'MangaReader',
                    color: 'text-purple-400',
                    time: '8 hours ago',
                    text: 'They skipped chapter 45 completely... disappointing adaptation choice. The manga handled this scene with way more emotional depth.',
                    avatar: '',
                    likes: 15,
                    dislikes: 2,
                    userAction: null,
                    replies: []
                },
                {
                    id: 'c6',
                    name: 'CasualWatcher',
                    color: 'text-pink-400',
                    time: '10 hours ago',
                    text: 'I have no idea what is going on anymore but the visuals are pretty so I am staying. ðŸ˜‚',
                    avatar: '',
                    likes: 3,
                    dislikes: 0,
                    userAction: null,
                    replies: []
                },
                {
                    id: 'c7',
                    name: 'Hater123',
                    color: 'text-gray-400',
                    time: '12 hours ago',
                    text: 'Overrated show. The main character is so annoying.',
                    avatar: '',
                    likes: 1,
                    dislikes: 45,
                    userAction: null,
                    replies: []
                },
                {
                    id: 'c8',
                    name: 'OtakuKing',
                    color: 'text-orange-400',
                    time: '1 day ago',
                    text: 'Wait for the next arc, it gets crazy good! Trust the process.',
                    avatar: '',
                    likes: 8,
                    dislikes: 0,
                    userAction: null,
                    replies: []
                },
                {
                    id: 'c9',
                    name: 'SubPolice',
                    color: 'text-cyan-400',
                    time: '1 day ago',
                    text: 'The translation for the final line is wrong. In Japanese he actually implies something totally different.',
                    avatar: '',
                    likes: 10,
                    dislikes: 1,
                    userAction: null,
                    replies: []
                },
                {
                    id: 'c10',
                    name: 'Newbie',
                    color: 'text-indigo-400',
                    time: '2 days ago',
                    text: 'Just started watching this, hooked immediately! ðŸ¿',
                    avatar: '',
                    likes: 6,
                    dislikes: 0,
                    userAction: null,
                    replies: []
                }
            ];
            allComments = defaultComments;
            localStorage.setItem('animeCommentsV2', JSON.stringify(allComments));
        }
        if (document.getElementById('comment-count-2')) {
            document.getElementById('comment-count-2').textContent = `${allComments.length} Comments`;
        }
        container.innerHTML = allComments.map(c => `
            <div class="flex gap-4">
                <img class="w-10 h-10 rounded-full object-cover bg-gray-700 flex-shrink-0" src="${c.avatar || ''}" onerror="this.src='https://ui-avatars.com/api/?name=${c.name}&background=random'"/>
                <div class="flex-1">
                    <div class="flex items-baseline gap-2 mb-1">
                        <span class="${c.color || 'text-primary'} font-bold text-sm">${c.name}</span>
                        <span class="text-gray-500 text-xs">${c.time}</span>
                    </div>
                    <p class="text-gray-300 text-sm mb-2">${c.text}</p>
                    <div class="flex items-center gap-4 text-xs text-gray-500 mb-2">
                        <button class="hover:text-white flex items-center gap-1" onclick="toggleReplyBox2('${c.id}')"><span class="material-symbols-outlined text-sm">reply</span> Reply</button>
                        <button class="flex items-center gap-1 hover:text-white ${c.userAction === 'like' ? 'text-primary' : ''}" onclick="voteComment2('${c.id}', 'like')">
                            <span class="material-symbols-outlined text-sm ${c.userAction === 'like' ? 'fill-current' : ''}">thumb_up</span> ${c.likes || 0}
                        </button>
                        <button class="flex items-center gap-1 hover:text-white ${c.userAction === 'dislike' ? 'text-red-500' : ''}" onclick="voteComment2('${c.id}', 'dislike')">
                            <span class="material-symbols-outlined text-sm ${c.userAction === 'dislike' ? 'fill-current' : ''}">thumb_down</span> ${c.dislikes || 0}
                        </button>
                        <button class="hover:text-white ml-auto">...</button>
                    </div>
                    <div id="reply-box-2-${c.id}" class="hidden mt-2 mb-4 flex gap-3">
                         <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold flex-shrink-0 text-xs">G</div>
                         <div class="flex-1">
                            <textarea id="reply-input-2-${c.id}" class="w-full bg-[#0B0E14] border border-gray-700 rounded-lg p-2 text-gray-300 focus:outline-none focus:border-primary h-16 resize-none text-sm" placeholder="Add a reply..."></textarea>
                            <div class="flex justify-end mt-1 gap-2">
                                <button class="text-gray-400 hover:text-white text-xs px-3 py-1" onclick="toggleReplyBox2('${c.id}')">Cancel</button>
                                <button class="bg-primary hover:bg-primary-dark text-white px-3 py-1 rounded text-xs font-semibold transition-colors" onclick="postReply2('${c.id}')">Reply</button>
                            </div>
                         </div>
                    </div>
                    ${c.replies && c.replies.length > 0 ? `
                        <div class="mt-2 space-y-3 pl-4 border-l-2 border-gray-800">
                            ${c.replies.map(r => `
                                <div class="flex gap-3">
                                    <img class="w-6 h-6 rounded-full object-cover bg-gray-700 flex-shrink-0" src="${r.avatar || ''}" onerror="this.src='https://ui-avatars.com/api/?name=${r.name}&background=random'"/>
                                    <div class="flex-1">
                                        <div class="flex items-baseline gap-2 mb-0.5">
                                            <span class="${r.color || 'text-primary'} font-bold text-xs">${r.name}</span>
                                            <span class="text-gray-500 text-[10px]">${r.time}</span>
                                        </div>
                                        <p class="text-gray-300 text-xs mb-1">${r.text}</p>
                                        <div class="flex items-center gap-3 text-[10px] text-gray-500">
                                            <button class="flex items-center gap-1 hover:text-white ${r.userAction === 'like' ? 'text-primary' : ''}" onclick="voteReply2('${c.id}', '${r.id}', 'like')">
                                                <span class="material-symbols-outlined text-[10px] ${r.userAction === 'like' ? 'fill-current' : ''}">thumb_up</span> ${r.likes || 0}
                                            </button>
                                            <button class="flex items-center gap-1 hover:text-white ${r.userAction === 'dislike' ? 'text-red-500' : ''}" onclick="voteReply2('${c.id}', '${r.id}', 'dislike')">
                                                <span class="material-symbols-outlined text-[10px] ${r.userAction === 'dislike' ? 'fill-current' : ''}">thumb_down</span> ${r.dislikes || 0}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            </div>
        `).join('');
    }
    function toggleReplyBox2(commentId) {
        const box = document.getElementById(`reply-box-2-${commentId}`);
        if (box) {
            box.classList.toggle('hidden');
        }
    }
    function postComment2() {
        const input = document.getElementById('comment-input-2');
        if (!input) return;
        
        const text = input.value.trim();
        if (!text) return;
        const newComment = {
            id: generateId(),
            name: 'Guest User',
            color: 'text-primary',
            time: 'Just now',
            text: text,
            avatar: '',
            likes: 0,
            dislikes: 0,
            userAction: null,
            replies: []
        };
        const saved = JSON.parse(localStorage.getItem('animeCommentsV2')) || [];
        saved.unshift(newComment);
        localStorage.setItem('animeCommentsV2', JSON.stringify(saved));
        input.value = '';
        // Reset counter
        const counter = document.getElementById('char-counter-2');
        if (counter) counter.textContent = '500 characters remaining';
        loadComments();
    }
    function postReply2(commentId) {
        const input = document.getElementById(`reply-input-2-${commentId}`);
        if (!input) return;
        
        const text = input.value.trim();
        if (!text) return;
        const allComments = JSON.parse(localStorage.getItem('animeCommentsV2')) || [];
        const commentIndex = allComments.findIndex(c => c.id === commentId);
        if (commentIndex !== -1) {
            const newReply = {
                id: generateId(),
                name: 'Guest User',
                color: 'text-primary',
                time: 'Just now',
                text: text,
                avatar: '',
                likes: 0,
                dislikes: 0,
                userAction: null
            };
            if (!allComments[commentIndex].replies) {
                allComments[commentIndex].replies = [];
            }
            allComments[commentIndex].replies.push(newReply);
            localStorage.setItem('animeCommentsV2', JSON.stringify(allComments));
            loadComments();
        }
    }
    function voteComment2(commentId, type) {
        const allComments = JSON.parse(localStorage.getItem('animeCommentsV2')) || [];
        const commentIndex = allComments.findIndex(c => c.id === commentId);
        if (commentIndex !== -1) {
            const comment = allComments[commentIndex];
            // Remove previous action effect
            if (comment.userAction === 'like') comment.likes--;
            if (comment.userAction === 'dislike') comment.dislikes--;
            // Apply new action or toggle off
            if (comment.userAction === type) {
                comment.userAction = null; // Toggle off if clicking same button
            } else {
                comment.userAction = type;
                if (type === 'like') comment.likes++;
                if (type === 'dislike') comment.dislikes++;
            }
            allComments[commentIndex] = comment;
            localStorage.setItem('animeCommentsV2', JSON.stringify(allComments));
            loadComments();
        }
    }
    function voteReply2(commentId, replyId, type) {
        const allComments = JSON.parse(localStorage.getItem('animeCommentsV2')) || [];
        const commentIndex = allComments.findIndex(c => c.id === commentId);
        if (commentIndex !== -1) {
            const replyIndex = allComments[commentIndex].replies.findIndex(r => r.id === replyId);
            if (replyIndex !== -1) {
                const reply = allComments[commentIndex].replies[replyIndex];
                 // Remove previous action effect
                if (reply.userAction === 'like') reply.likes--;
                if (reply.userAction === 'dislike') reply.dislikes--;
                // Apply new action or toggle off
                if (reply.userAction === type) {
                    reply.userAction = null;
                } else {
                    reply.userAction = type;
                    if (type === 'like') reply.likes++;
                    if (type === 'dislike') reply.dislikes++;
                }
                allComments[commentIndex].replies[replyIndex] = reply;
                localStorage.setItem('animeCommentsV2', JSON.stringify(allComments));
                loadComments();
            }
        }
    }
    // --- Rating Logic ---
    let voteCount = 1245;
    let currentRating = 6.3;
    let hasVoted = false;
    // Initialize Vote State from LocalStorage
    if(localStorage.getItem('hasVoted')) {
        const savedVote = localStorage.getItem('hasVoted');
        hasVoted = true;
        // Don't show voted state automatically on page load, only when modal is opened if we wanted
        // But for UX, let's keep the main button available but change its text maybe? 
        // For now, let's just respect the "Rate once" logic inside the modal.
        const mainBtn = document.getElementById('main-vote-btn');
        if (mainBtn) {
            mainBtn.innerText = "Voted";
            mainBtn.classList.add('bg-gray-300', 'text-gray-600', 'cursor-not-allowed');
            mainBtn.classList.remove('bg-white', 'text-black', 'hover:bg-gray-200');
        }
        // Adjust counts visually based on stored simulated data if we were persisting counts
    }
    function openVoteModal() {
        const modal = document.getElementById('vote-modal');
        modal.classList.remove('hidden');
        if (hasVoted) {
             document.getElementById('vote-options').classList.add('hidden');
             document.getElementById('voted-state').classList.remove('hidden');
             document.getElementById('user-vote-selection').textContent = localStorage.getItem('userVoteChoice');
        } else {
             document.getElementById('vote-options').classList.remove('hidden');
             document.getElementById('voted-state').classList.add('hidden');
        }
    }
    function closeVoteModal() {
        document.getElementById('vote-modal').classList.add('hidden');
    }
    function submitVote(voteType) {
        if(hasVoted) return;
        hasVoted = true;
        voteCount++;
        localStorage.setItem('hasVoted', 'true');
        localStorage.setItem('userVoteChoice', voteType);
        // Simulate score change based on vote
        let scoreChange = 0;
        if(voteType === 'Amazing') scoreChange = 0.1;
        if(voteType === 'Boring') scoreChange = -0.1;
        currentRating = parseFloat((currentRating + scoreChange).toFixed(1));
        // Update UI
        updateRatingUI();
        // Show Success in Modal
        document.getElementById('vote-options').classList.add('hidden');
        document.getElementById('voted-state').classList.remove('hidden');
        document.getElementById('user-vote-selection').textContent = voteType;
        // Update Main Button Style
        const mainBtn = document.getElementById('main-vote-btn');
        if (mainBtn) {
            mainBtn.innerText = "Voted";
            mainBtn.classList.add('bg-gray-300', 'text-gray-600', 'cursor-not-allowed');
            mainBtn.classList.remove('bg-white', 'text-black', 'hover:bg-gray-200');
        }
        // Close modal after delay
        setTimeout(() => {
            closeVoteModal();
        }, 2000);
    }
    function updateRatingUI() {
        const formattedCount = voteCount.toLocaleString() + ' votes';
        // Desktop
        const ratingScore = document.getElementById('rating-score');
        if (ratingScore) ratingScore.textContent = currentRating;
        
        const voteCountDisplay = document.getElementById('vote-count-display');
        if (voteCountDisplay) voteCountDisplay.textContent = formattedCount;
        
        // Mobile Sticky
        const mobileScore = document.getElementById('mobile-rating-score');
        if(mobileScore) mobileScore.textContent = currentRating;
        
        // Modal
        const modalRating = document.getElementById('modal-rating-score');
        if (modalRating) modalRating.textContent = currentRating;
        
        const modalVoteCount = document.getElementById('modal-vote-count');
        if (modalVoteCount) modalVoteCount.textContent = formattedCount;
    }
    // --- Init ---
    // Mobile Menu Toggle
    function toggleMobileMenu() {
        const menu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-menu-overlay');
        menu.classList.toggle('menu-open');
        overlay.classList.toggle('hidden');
    }
    // Mobile Search Toggle
    function toggleMobileSearch() {
        const searchBar = document.getElementById('mobile-search-bar');
        searchBar.classList.toggle('hidden');
        // Focus on input when opened
        if (!searchBar.classList.contains('hidden')) {
            setTimeout(() => {
                const mobileInput = document.getElementById('mobile-search-input');
                if (mobileInput) mobileInput.focus();
            }, 100);
        }
    }
    // Mobile Dropdown Accordion
    function toggleMobileDropdown(id) {
        const dropdown = document.getElementById(id);
        const arrowId = id === 'genre-mobile' ? 'genre-arrow' : 'country-arrow';
        const arrow = document.getElementById(arrowId);
        dropdown.classList.toggle('hidden');
        if (dropdown.classList.contains('hidden')) {
            arrow.style.transform = 'rotate(0deg)';
        } else {
            arrow.style.transform = 'rotate(180deg)';
        }
    }
    // Run on load
    document.addEventListener('DOMContentLoaded', function() {
        // Only run original functions if 11ty data is not present
        if (!document.querySelector('#main-player') || !document.querySelector('#main-player').id) {
            renderPopular();
            renderRecommended();
            renderEpisodeList();
            updateNavButtons();
            loadComments();
        }
    });
</script>

</body></html>